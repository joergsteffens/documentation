////
; Copyright (c) uib gmbh (www.uib.de)
; This documentation is owned by uib
; Until we found a better license:
; All rights reserved.
; credits: http://www.opsi.org/credits/
////

:Author: uib gmbh
:Date:      19.10.2017
:Revision:  4.1


include::../common/opsi_terms.asciidoc[]


[[software-on-demand]]
=== opsi Software On Demand (Kiosk-Mode) (free)

[[software-on-demand_introduction]]
==== Introduction

With the module "Software-on-Demand" opsi administrators may give their users access to install a range of software-products.
These software products may be selected and installed user-driven without the administrator needing to do anything.
This documentation shows how the module "Software-on-Demand" works, describes it's functions and how to configure it.

[[software-on-demand_prerequisits]]
==== Prerequisites

There are some preconditions for using the extension.
The product-groups are needed, available with opsi 4.0.
Furthermore the opsi-client-agent and the opsi-configed at version 4.0.1 are needed.

Ab opsi-client-agent Version 4.1.1.6-5 steht der Kiosk als eigenständiges Paket (opsi-client-kiosk) zur Verfügung. Es wird aber bei der Installation des opsi-client-agent gegenenfalls mit installiert falls es noch nicht vorhanden ist. 

.Required Packages
[options="header"]
|==========================
|opsi-Package|Version
|opsi-client-agent|>=4.0.1-3,  >=4.1.1.6-5**
|opsi-winst|>=4.10.8.12
|python-opsi|>=4.0.1-7
|opsi-server|>=4.0.1-2
|opsi-configed|>=4.0.1.6-1
|opsi-client-kiosk**|>=4.1.1.7-6
|==========================

**ab opsi-client-agent Version >=4.1.1.6-5 wird der Kiosk als eigenständiges Paket (opsi-client-kiosk) geführt. Er wird aber bei der Installation des opsi-client-agents automatisch mit installiert falls er nicht vorhanden ist. Für mehr Details siehe nächstes Kapitel.

CAUTION: Wenn Sie viel Mühe in die individuelle Gestaltung des Kiosk gesteckt haben wird empfohlen das custom Verzeichnis zu sichern bevor Sie einen neuen Kiosk/client-agent auf dem Depot einspielen: +
Kiosk als eigenständiges Paket (opsi-client-kiosk): `/var/lib/opsi/depot/opsi-client-kiosk/files/app/ock_custom`
Kiosk noch im opsi-client-agent Paket integriert: 
`/var/lib/opsi/depot/opsi-client-agent/files/opsiclinetkiosk/app/ock_custom` oder `/var/lib/opsi/depot/opsi-client-agent/files/opsiclinetkiosk/ock_custom` +
In seltenen Fällen auch `/var/lib/opsi/depot/opsi-client-agent/files/opsiclinetkiosk/files_to_copy/ock_custom`


[[software-on-demand_kiosk_migration]]
===== Automatische Migration des Kiosks aus dem opsi-client-agent (>=4.1.1.6.5)

Damit möglichst wenig Änderungen manuell durchgeführt werden müssen wird versucht die Einstellungen des Kiosk automatisch aus dem opsi-client-agent in das opsi-client-kiosk Paket zu migrieren und dieses gegebenenfalls mit auf dem Depot bzw. den entsprechenden Clients zu installieren. In der Regel geschieht das weitestgehend automatisch und Sie müssen nichts weiter tun. 

Zum Besseren Verständnis ist der Ablauf hier aber etwas genauer beschrieben. Es ist dabei wichtig zu Unterscheiden was bei der Installation des opsi-client-agents auf einem Depot und was bei der Installation auf einem Client passiert.

[underline]#Installation opsi-client-agent Version (>=4.1.1.6-5) auf einem Depot#

Es wird bei der Installation des opsi-client-agents auf dem Depot das opsi-client-kiosk Paket unter bestimmten Voraussetzungen mit auf dem Depot installiert. Dabei wird versucht die Kioskeinstellungen aus dem opsi-client-agent Paket in das opsi-client-kiosk Paket zu migrieren. Beides passiert nur wenn folgende Bedingungen erfüllt sind:

* das opsi-client-kiosk Paket ist NICHT auf dem Depot installiert
* der opsi-client-agent (>=4.1.1.6-5) wird über einen alten opsi-client-agent installiert der den alten Kiosk noch enthält (d.h. enthält das Verzeichnis opsiclientkiosk, bzw. \<=4.1.0.0)

[underline]#Installation opsi-client-agent Version (>=4.1.1.18-1) auf einem Client#

Bei der Installation des opsi-client-agent (>=4.1.1.18-1) auf einem Client wird der opsi-client-kiosk unter bestimmten Voraussetzungen auf setup gestellt. Dies passiert wenn folgende Bedingungen erfüllt sind:

* der opsi-client-kiosk ist NICHT auf dem Client installiert
* der config/Host-Patrameter software-on-demand.active steht auf true für diesen Client

Somit wird der opsi-client-kiosk auf dem entsprechenden Client in den meisten Fällen automatisch im Anschluss der opsi-client-agent Installation mit installiert, da der Client-PC in der Regel rebooted wird und das opsi-clientd Event gui_startup eintritt welches meist konfiguriert sein sollte.

Sollte es passieren dass der Kiosk auf manchen Clients, trotz versuchter automatischer Migration/Installation, nicht vorhanden ist so kontrollieren Sie bitte:

a. ob ein opsi-client-kiosk Paket auf dem Depot installiert ist an dem der Client angebunden ist, wenn nicht installlieren Sie dieses bzw. den aktuellen opsi-client-agent +
b. ob der opsi-client-kiosk auf dem Client installiert ist, wenn nicht setzten Sie ihn auf setup


[[software-on-demand_configuration-parameter]]
==== configuration

The configuration of this extension is based on product-groups and config-variables.
The used config-variables are:

* software-on-demand.active
* software-on-demand.product-group-ids
* software-on-demand.show-details

These config-variables are created with installing the opsi-server-package.

[[software-on-demand_product-group-management]]
===== Managing product-groups

The most comfortable way to create and manage product-groups is using the `opsi-configed`.
There you have to change to the tab `product configuration`.

TIP: Since version 4.0.1.6 of the `opsi-configed` you can change to `product configuration` without choosing a client.

The product-group menu is above the product list.

.product-group menue
image::configed_productgroup_en.png[width=300]

With the drop down menu you can choose a product-group to edit it.
If you have chosen a group, the corresponding products will be highlighted.
 +
With a second icon, filter can be activated or deactivated.
When a filter was activated, only the products of the activated product-group are seen.
 +
Product-groups can be edited after activating the icon with the yellow packets (show editor / hide editor) next to the icon with the filter.
In this view, a new group and it's description can be added. Save the editing by activating the red check icon.
 +
If some more products should be added to a group, select them and press the red check icon. (Press the <ctrl> button and select the products).

[[software-on-demand_configuration]]
===== configure the module Software-On-Demand

The module can be configured, as mentioned above, with the config-variables described in the following table:

.overview of the config-variables of the module Software-on-Demand
[options="header"]
|==========================
|Configuration|Description|Values
|software-on-demand.active|activates or deactivates the modul, bzw. wird als Flag für die Migration verwendet (<<software-on-demand_kiosk_migration, Automatische Migration des Kiosks aus dem opsi-client-agent (>=4.1.1.6.5)>>). Hat für den opsi-client-kiosk ab Version >=4.1.1.6-5 keine Relevanz mehr.|true/false
|software-on-demand.product-group-ids|Product-groups with software-products, that can be used for Software-on-Demand.|List of produkt-groups

|==========================

There are two ways to use these configuration objects.
For the whole system or for each client.
The following 2 chapters will explain both ways.

[[software-on-demand_systemwide-configuration]]
===== Configuration for the whole system

The configuration here is the default system wide for every client.
The configuration can be edited in the `opsi-configed`. Push the Button `Server Configuration` and change to the tab `Host Parameter`

.part of the module server configuration in the opsi configuration editor
image::configed_serverconfiguration_en.png[width=300]

Another possibility is to change the server-configuration with the following command:

[source, prompt]
----
opsi-setup --edit-config-defaults
----

.edit-config-defaults with opsi-setup
image::editconfigdefaults.png[width=300]

TIP: Administration is also possible with the opsi-python-API or with 'opsi-admin'

[[software-on-demand_client-configuration]]
===== Configuration for a single client

The configuration for a single client - or client specific configuration - is useful if, for example, only some of the clients should have access to the Software-on-Demand extension. Or if you want to make several product groups available to some clients. +

The configuration of the client specific host parameters can be edited in different ways: +

The most comfortable way to edit the configuration is via '{opsi-configed}'.
Choose one or several clients (even all clients of a client group if you want to)
and then navigate to the tab "Host parameters".

.edit hostparameter in the configuration editor
image::opsi-configed-hostparameters.png[width=300]

This editing overrides the system wide defaults.

////
[[software-on-demand_event-configuration]]
===== opsiclientd event-configuration

There are two ways for the users to start the software-installation:

* with the next system start
* immediately

If the user chooses "with the next system start", the product state will be set to "setup."
If the choice is "immediately", the '{opsiclientd}' creates an event `software on demand`. This event can be configured in the file `opsiclientd.conf` as any other event.
////

[[software-on-demand_clientagent-kiosk]]
==== New opsi-client-kiosk application

Mit der opsi-client-agent Version (>=4.1.1.6-5) steht der Kiosk als eigenständiges Produkt zu Verfügung und wird als solches bei der Installation des opsi-client-agents mit installiert (opsi-client-kiosk). Dabei wird versucht die vorhandene Kiosk Einstellungen zu migrieren. +

Hintergrund dieses Wechsels sind:

* einfachere Pflege des opsi-client-agent Pakets
* Änderungen am Kiosk können unabhängig vom opsi-client-agent Paket veröffentlicht werden 
* Ermöglicht neue Einstellungen des Kiosk für die Clients zu übernehmen ohne dass der opsi-client-agent neu installiert werden muss

NOTE: Bei der Installation des opsi-client-agent (>=4.1.1.6-5) auf dem Depot wird das opsi-client-kiosk Paket gegebenenfalls mit installiert. Für Clients wird das opsi-client-kiosk Produkt bei der Installation des opsi-client-agents (>=4.1.1.18-1) auf dem Client gegebenenfalls auf setup gesetzt. Für Details siehe <<software-on-demand_kiosk_migration, Automatische Migration des Kiosks aus dem opsi-client-agent (>=4.1.1.6.5)>>

CAUTION: The old (Web based) Kiosk client no longer works with the new opsi-client-agent/opsiclientd.

[[software-on-demand_install]]
===== Client Kiosk: Installation

If the opsi-client-agent during the installation notes that, the configuration (Host Parameter): _software-on-demand.active_ is set to _true_, it will automatically create a Start menu item during the installation on the Client, on which the Kiosk application can be run directly. It can be found under: _Start -> Programs -> opsi.org -> software-on-demand_.

The installation may be controlled by the following 'opsi-client-kiosk' product properties:

* `startmenue_entry` +
The Start Menu entry for the Client Kiosk (software on demand). +
Default=`software on demand`; editable

* `startmenue_folder` +
The Start Menu folder for the Client Kiosk (opsi.org) +
Default=`opsi.org`; editable

* `desktop_icon` +
Create a desktop icon for client kiosk ? +
Default=`false`

* `install_icon_collection` +
Für adminsitrative Zwecke kann eine Icon-Collection mit installiert werden. Nur empfehlenswert wenn auf dem Client über den Kiosk-Adminmodus Produkticons gesetzt werden sollen und man welche aus der Icon-Collection auswählen möchte. +
Default=`false`

The used icon for the start menu / Desktop may be modified by storing a `kiosk.ico` file at
`/var/lib/opsi/depot/opsi-client-kiosk/files/app/ock_custom/skin/` (since opsi-client-kiosk version 4.1.1.7-2).



[[software-on-demand_usage]]
===== Client kiosk: Usage


*Standard mode*

[[ock_mainwindow_standard]]
.Main window (standard mode)
After start of the kiosk all products which are assigned to the kiosk are shown on product tiles within the main window. The switch "All" is marked in the filter switch panel (<<ock_image_mainwindow, Figure 5>>). 


[[ock_image_mainwindow]]
.Kiosk (standard mode) - Main window with product tiles.   (1)&#160;Window panel. (2)&#160;Header panel. (3)&#160;Filter switch. (4)&#160;Opens the search mask. (4)&#160;Opens the help. (6)&#160;product tile
image::opsi-client-kiosk_mainwindow.png["Main window with product tiles", width=500]


_Window panel (1) and Header panel (2)_ + 
In the standard mode the version of the kiosk and, if applicable, the info that installations as from now are disabled are shown in the window panel&#160;(1) (see also <<ock_dialogs, dialogs for installation/uninstallation and update of the product>>). The header panel&#160;(2) is customisable. See section <<opsi-manual-clientagent-ci-opsiclientd, Corporate Identity>> of the opsi-client-agent for more details.


_Filter switch (3)_ +
By clicking on the filter switch&#160;(3) "Updates", "Not Installed" or "Actions" only products are shown with the choosen status.

_Product tiles (4)_ +
Products are displayed by product tiles.
Product tiles show first information about the product. That are the name of the product, if set, a specific product icon otherwise a standard icon, as well as the status of the product and, if a action is set, the respective action.  



NOTE: Only if an action is set an action is displayed otherwise nothing is displayed.


After clicking on a product tile the tiles are hidden and detailed information of the selected product are shown (<<ock_image_detailed_view, Figure 7>>).


_Search (5)_ +
Click on the magnifying glass to open a search field (<<ock_image_searchfield, Figure 6>>).


[[ock_image_searchfield]]
.Search field of the kiosk
image::opsi-client-kiosk_searchfield.png["Search field of the kiosk", height=60]

Use the search field to search for specific products. All fields of the product will be searched. Only products which fit to the search term will be displayed e.g. because the term is in the name or in the description of the product.
Clicking on th "X" within the search field will clear the search field and all products are displayed again. The same effect has a click on the magnifying glass above the serach filed (<<ock_image_mainwindow, Figure 5>>) but additionally the search field is hidden. 


_Help (6)_ +
Via the button "help" the help window is reached.


[[ock_productview]]
.Detailed product view
After clicking on a product tile the detailed product view is shown.


[[ock_image_detailed_view]]
.Kiosk (standard mode) - detailed product view. (1)&#160;back to main window. (2)&#160;(Un)install product respectively removes action. (3)&#160;Info block (5)&#160;Updates the product. (6)&#160;Description  and hints of the product.
image::opsi-client-kiosk_detailed_product_view.png["Detailed product view", width=500]

_Back (1)_ +
Back to main window (<<ock_image_mainwindow, Figure 5>>).

_Install/Uninstall product or removes action (2)_ +
Clicking on this button opens a dialog to install/uninstall the product or removes the action set before.

 

NOTE: The functionallity of this button depends on the product state (installed/not installed, action set)


_Info block (3)_ +
The info block shows the installed version and the current available version as well as the respective action if it is set.


_Screenshot (4)_ +
Shows, if available, a screenshot of the product.


TIP: Ask your system administrator if no screenshot is displayed but you like to have one.

_Update (5)_ +
Opens a dialog to update the prodcut.


NOTE: This button is only displayed if an update is available i.e.  the installed version differs from the newest available version.


_Description and Notes (6)_ +
Here the prodcut description and notes are presented.


TIP: The prodcut description and notes are only as good as they are incorporated into the opsi-products. Ask your system administartor or package manager if they are not understandable. 


[[ock_dialogs]]
.Dialogs for installation/uninstallation and updating of products
A dialog is displayed after clicking on the respective button within the detailed prodcut view. Either you are directly prompt for confirmation of the action (<<ock_image_dialog_timechoice, Figure 8>>) or an additional dialog is shown where you can select the starting point of the requested action (now or later after standard event e.g. reboot,  <<ock_image_dialog_timechoice, Figure 9>>)


[[ock_image_dialog_confirmation]]
.Kiosk - Dialog for confirmation of the requested action.
image::opsi-client-kiosk_dialog_confirmation.png["Dialog for confirmation of the requested action"]

[[ock_image_dialog_timechoice]]
.Kiosk - Dialog to select the starting point of the requested action.
image::opsi-client-kiosk_dialog_select_starting_point.png["Dialog to select the starting point of the requested action"]

NOTE: The dialog for selecting the starting point of the requested action is only shown if the installation as from now is not disabled by your system administrator


[[ock_help]]
.Help window

The help window (<<ock_image_help, Figure 8>>) displays information about the opsi client kiosk. Via the help window it is also possible to launch this manual. In addition the kiosk can be put into the expert mode from here.

[[ock_image_help]]
.Kiosk - Help window. (1)&#160;Info block. (2)&#160;Opsi manual. (3)&#160;Check box for expert mode
image::opsi-client-kiosk_help.png["Help window"]

_Info block (1)_ +
Here information about the opsi client kiosk are shown. Via the links it is possible to launch the uib or opsi webpage in your preferred browser.


_Opsi manual (2)_ +
Link to the opsi manual. 


_Expert mode (3)_ +
Activation of the check box activates the expert mode.


*Expert mode*

[[ock_mainwindow_expert]]
.Main window (expert mode)
Is the expert mode activated (activation via the help <<ock_help,Help>>) you can switch between the tile view of the standard mode and a list view. In the list view the prodcuts are displayed in a table among each other. The additional buttons 'Installation now' and 'Reload' are displayed (<<ock_image_expertmode,Figure 11>>). 


NOTE: Only if the installation as from now is not disabled the button 'Installation now' is shown.


[[ock_image_expertmode]]
.Kiosk (expert mode) - List view. (1)&#160;Check box to toggle view. (2)&#160;List view of the products. (3)&#160;Button for installing products (as from now). (4)&#160;Button for synchronisation with the server. (5)&#160;Detailed informationen of the product.
image::opsi-client-kiosk_expert_mode.png["Kiosk - Experte mode (List view)", width=500]

_Toggle view (1)_ +
Using the check box you can toggle between list view and the tiles view.

_List view (2)_ +
In the list view the products are displayed in a table among each other. In the column `ActionRequest` an action request can be set. 

NOTE: Depending on product state the actions which can be set in the column `ActionRequest` may differ. Setting the action to `setup` yields to the installation or update of the product. The action `none` is for resetting an action which was set but was not executed until now. 

_Installation now (3)_ _- only available if the installation as from now was not disabled_ + 
Clicking on the button 'Installation now' opens a seperate window showing the actions set. You can choose if the actions shall be execute now or later at next standard event (<<ock_image_actionwindow,Figure 12>>).

[[ock_image_actionwindow]]
.Kiosk (Expert mode) - Window for the execution of the actions set.
image::opsi-client-kiosk_action_window.png["Window for the execution of the actions set"]

.Window for the execution of the actions set
At this window (<<ock_image_actionwindow,Figure 12>>) you can execute an installation as from now (button `Installation now`). In this case it would be advisable to close all other applications (i.e. to save your data) because the started installations may come in conflict with currently running applications. +
Using the button `Install at next standard event (e.g. reboot)` closes the window and the actions will be proceed later at next standard event.

*Admin mode*

TIP: To execute the kiosk in the admin mode the config `software-on-demand.admin-mode = true` had to be set. In addition
the kiosk must be executed as user with admin privileges or as administrator. 

Using the kiosk in admin mode allow to set product icons and screenshots for the products. Therefore you need to click with the rigth mouse button on the icon or screenshot or its respective placeholder. This opens a file dialog from which the desired image can be chosen. This works within the main window as well as in the detailed prodcut view.
A click on the button image:opsi-client-kiosk_save_on_depot.png[title="Save on depot"] (<<ock_image_adminmode,Figure 13>>) opens a dialog to save the icons/screenshots on an opsi depot which means that these icons/screenshots are than also available for other kiosk installations.

[[ock_image_adminmode]]
.Kiosk (Admin mode).(1)&#160;Click on this button opens a dialog to save the icons/screenshots on an opsi depot.
image::opsi-client-kiosk_admin_mode.png["Kiosk - Admin mode"]

CAUTION: After setting icons and screenshot within the kiosk the icons and screenshots are saved on the client only locally. To make these images available for kiosk installations on other clients they had to be copied to the ock-custom folder (e.g with the kiosk as described above).

NOTE: The config `software-on-demand.show-details` from opsi 4.0.7 has no effect on the kiosk anymore and can be deleted.

*Logs of the opsi-client-kiosk program:* +

The program logs to `%Appdata%\opsi.org\log`. That is the `opsi.org\log` directory in the Appdata directory of the loggedin user. +
For Example: +
`C:\Users\<username>\AppData\Roaming\opsi.org\log\`


[[software-on-demand_notice]]
==== Characteristics

The following apply to the software-on-demand module:

* Dependencies are resolved automatically +
   - Software that depends on software from the Demand group, will automatically be set to setup (install), without interaction from the user..

[[software-on-demand_CI]]
===== Client kiosk: Customizable to Corporate Identity

Die Headerleiste des Hauptfensters (1) ist kundenspezifisch anpassbar. Dabei spielen drei Dateien im ock_custom Verzeichnis  (`/var/lib/opsi/depot/opsi-client-kiosk/files/app/ock_custom/skin`) eine Rolle:

* `header.png`
* `logo.png`
* `opsiclientkiosk.ini`

Die `header.png` enthält das Bild welches links vom Logo in diesen Bereich geladen wird, `logo.png` das Logo. +

Die `opsiclientkiosk.ini` definiert den Text und dessen Darstellung die in diesem Bereich angezeigt wird (ab opsi-client-kiosk Version 4.1.1.7-2).

Beispiel:

----
[TitleLabel]
Text= Softwarekorb
FontName = Arial
FontSize = 20
FontColor = $00ffffff
FontBold = true
FontItalic = false
FontUnderline = false
----


Das verwendete Desktop/Startmenü-Icon kann durch Ablegen einer `kiosk.ico` Datei im ock_custom/skin Verzeichnis verändert werden (ab opsi-client-kiosk Version 4.1.1.7-2).

